# Car-value-prediction

### Предисловие

Хотелось бы выразить благодарность составителям работы, ну очень познавательно. Если честно, то до этого задания я до конца не понимала, зачем вы вообще занимаемся разведочным анализом данных и уж тем более визуализацией. Теперь всё встало на свои места. 

### "Что было сделано?"

1. Проведен разведочный анализ данных
2. Обработаны признаки: пустые значения заменены по рекомендации на медианные значения, убраны дубликаты, убраны единицы измерения для признаков mileage, engine, max_power, разделен torque на 'torque' и 'max_torque_rpm'. Разделение и обработка признака torque были достаточно трудозатратным из-за разной формы записи характеристики.
3. Проведена визуализацию по плану, но добавлена дополнительная: рассмотрены категориальные признаки, их распределение и корреляция с целевой переменной; оценены выбросы, диапазон распределения значений и разброс данных посредством boxplot графиков.
4. Обучены модели на вещественных признаках. Наиболее результативно показала себя простая линейная модель. Здесь можно сделать вывод, что одних вещественных признаков для информативности недостаточно.
5. Добавлены категориальные признаки. Вот с добавление категориальных признаков метрики модели возросли. В качестве основной была использована гребневая Ridge ( с помощью класса GridSearchCV), этот же тип модели использовался как наилучший при реализации сервиса. Стоит отметить следующее: а). метрики хоть и возросли, но не колоссально - R2 вырос на 0.07 для трейна и 0.03 для теста. б). кодирование методом OneHot сопровождалось сложностями, поскольку трейн и тест обладали разными наборами значений для качественных признаков.
6. Улучшены предсказания модели за счет Feature Engineering. Было реализовано следующее: а) новые признаки на основе уже существующих ('horsepower_per_litre', 'year_squared', 'mileage_squared', '{fuel_type}_max_power'); б) добавлены новые признаки 'brand'; в) сделано логарифмическое преобразование для целевой переменной; г) а также серия неудачных экспериментов: добавление классов автомобилей (на основе бренда и миниресерча в гугле), сочетание признаков 'first_or_second_owner_and_official_dealer', признаки, указывающие, что другой признак был заменен медианным значением '{feature}_was_missing' - все эти дополнительные признаки не дали никакого результата, поэтому из итоговой выборки были удалены.
7. Посчитана бизнесовая метрика.
8. Реализован сервис на FastAPI с тремя запросами: @app.post("/predict_item"), @app.post("/predict_items") и @app.post("/predict_csv"). Один запрос с множественными объектами был разделен на два, чтобы удовлетворить все требования к запросам: и predict_items(items: List[Item]) -> List[float] и "на вход подается csv-файл с признаками тестовых объектов, на выходе получаем файл с +1 столбцом". 
9. Оформлен гитхаб.
10. Отлично проведено время.
    
### "с какими результатами?"

Наилучшая модель имела следующие метрики: R2 train: 0.8924334950145935, MSE train: 0.06285976724980559 и R2 test: 0.9198407249008501, MSE test: 0.05733809605807397. 
Бизнесовые метрики (доля предиктов, отличающихся от реальных цен на авто не более чем на 10%): for train: 0.352 и for test: 0.354.

### "что дало наибольший буст в качестве?"

Самый большой буст дало логарифмическое преобразование для целевой переменной и добавление признака 'brand', а так в целом добавление категориальных признаков.

### "что сделать не вышло и почему?"

Единственная причина, почему некоторые дополнительные признаки не были реализованы, это нехватка времени (тут признаюсь откровенно), других причин, которые бы ограничивали Feature Engineering не было. Некоторые экспериментальные признаки были абсолютно не информативными, но на то они и экспериментальные. 

### Посмотрим на сервис

Сервис реализовывала на локальном сервере с помощью uvicorn, поскольку строгих рекомендаций в этом вопросе не было. Вот несколько скриншотов с результатом работы сервиса, на фото Postman, поскольку при проверке использовала именно его. 

![image](https://github.com/AlbinaBurlova/Car-value-prediction/assets/117646051/2391d55a-37a2-4809-94fb-e19514f9ea08)

![image](https://github.com/AlbinaBurlova/Car-value-prediction/assets/117646051/aefb1388-5135-4251-b312-c3bd20b726d8)

![image](https://github.com/AlbinaBurlova/Car-value-prediction/assets/117646051/fed18541-f64a-47c3-82cf-e7380a86620f)

### Post scriptum

Надеюсь, я доберусь до пятого пункта проверки работы. Держу кулачки.

### Author

Albina Burlova
